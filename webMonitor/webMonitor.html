<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
  <meta name="viewport" content="width=device-width" />
  <title>Hand Tracking System 1.0</title>
  <link rel="icon" type="image/png" href="../assets/img/favicon.png" />

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <!-- <link href="../assets/css/bootstrap.min.css" rel="stylesheet" /> -->
  <!-- <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script> -->
  <script src="../assets/js/canvasjs.min.js"></script>
  <script src="https://unpkg.com/moment"></script>
  <link href="https://netdna.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.css" rel="stylesheet">
  <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script> -->
  <script src="../assets/js/jquery-3.5.1.min.js"></script>
	<script src="../assets/js/js-bootstrap-3.4.1.min.js"></script>
  <script src="../assets/js/pdf.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>

  <!-- CSS Files -->
  <link href="../assets/css/bootstrap.min.css" rel="stylesheet" />
  <link href="../assets/css/paper-bootstrap-wizard.css" rel="stylesheet" />

  <!-- CSS Just for demo purpose, don't include it in your project -->
  <link href="../assets/css/demo.css" rel="stylesheet" />

  <!-- Fonts and Icons -->
  <link href='https://fonts.googleapis.com/css?family=Muli:400,300' rel='stylesheet' type='text/css'>
  <link href="../assets/css/themify-icons.css" rel="stylesheet">

  <!-- custome -->
  <link rel="stylesheet" href="../assets/css/custome_page/webMonitor.css">
</head>


<body>

  <section class="contact-form">

    <div class="container-fluid">
      <div class="tab-content">

        <div class="container-fluid">
          <div class="row">
            <div class="container-fluid">
              <br>
              <div class="container-fluid">
                <div class="card wizard-card" data-color="green">
                  <form>
                    <div class="wizard-header">
                      <h3 class="wizard-title">สรุปผลรายงาน</h3>
                    </div>
                    <div class="wizard-navigation">
                      <div class="progress-with-circle">
                        <div class="progress-bar" role="progressbar" aria-valuenow="1" aria-valuemin="1" aria-valuemax="4" style="width: 15%;"></div>
                      </div>
                      <ul>
                        <li aria-disabled="true">
                          <a href="#home" data-toggle="tab">
                            <div class="icon-circle">
                              <i class="fa fa-user-plus"></i>
                            </div>
                            ประวัติการรักษา
                          </a>
                        </li>
                        <li aria-disabled="true">
                          <a href="#menu1" data-toggle="tab">
                            <div class="icon-circle">
                              <i class="fa fa-clipboard"></i>
                            </div>
                            พัฒนาการการรักษา
                          </a>
                        </li>
                      </ul>
                    </div>
                    <div class="tab-content">
                      <div id="home" class="container tab-pane active"><br>
                        <h3>ประวัติการรักษา</h3>
                        <div class="row">
                          <div class="form-group col-sm-4">
                            <div class="form-group col-sm-12">
                              <label for="fileInput">นำเข้าไฟล์ข้อมูลผู้ป่วย</label>
                              <input type="file" class="form-control" name="fileInput" id="fileInput" required title="กรุณาทำการเลือกไฟล์"><br>
                              ผู่ป่วยมาทำการรักษา : <span id="count">-</span> ครั้ง<br><br>
                              <button class="file btn-danger" style="color: rgb(255, 255, 255);" id="download"> download PDF</button>
                              <select name="list" id="personlist" onchange="showdate()"></select>
                            </div>
                          </div>
                          <div class="form-group col-sm-8">
                            <div class="form-group col-sm-12">
                              <div class="card" id="invoice">
                                <div class="card-header bg-transparent header-elements-inline">
                                  <div class="text-center">
                                    <img src="assets/img/icon-bg.png" style="width:15%">
                                    <b>
                                      <h5 class="card-title ">Physical Therapy Assessment</h5>
                                    </b>
                                    <b>
                                      <h5 class="card-title ">Walailak University</h5>
                                    </b>
                                  </div>
                                </div>
                                <div class="card-body">
                                  <div class="form-inline">
                                    <div class="col-sm-12">
                                      <label><b>Physical therapist:</b></label>
                                      <span id="physiotherapist_number"></span>
                                    </div>
                                    <div class="col-sm-12">
                                      <label><b>HN:</b></label>
                                      <span id="patient_number"></span>
                                    </div>
                                    <div class="col-sm-8">
                                      <label><b>Patient’s name:</b></label>
                                      <span id="f_name"> </span> <span id="l_name"></span>
                                    </div>
                                    <div class="col-sm-4">
                                      <label><b>BirthDay:</b></label>
                                      <span id="birthday"></span>
                                    </div>
                                    <div class="col-sm-6">
                                      <label><b>Sex:</b></label>
                                      <span id="gender"></span>
                                    </div>
                                    <div class="col-sm-6">
                                      <label><b>Occupation:</b></label>
                                      <span id="occupation"></span>
                                    </div>
                                    <div class="col-sm-12">
                                      <label><b>Hospital:</b></label> คลินิกกายภาพบำบัด มหาวิทยาลัยวลัยลักษณ์
                                    </div>
                                    <div class="col-sm-12">
                                      <label><b>Date: </b></label>
                                      <span id="date_treatment"></span>
                                    </div>
                                    <div class="col-sm-12">
                                      <label><b>Chief complaint:</b></label>
                                      <span id="chief_compalaint"></span>
                                    </div>
                                    <div class="col-sm-12">
                                      <label><b>PT diagnosis:</b></label>
                                      <span id="pt_diagnosis"></span>
                                    </div>
                                    <div class="col-sm-12">
                                      <label><b>Present history</b></label>
                                      <div id="history_illnessid"> </div>
                                    </div>
                                    <div class="col-sm-12">
                                      <br>
                                    </div>
                                    <div class="col-sm-12">
                                      <label><b>Underlying disease:</b></label>
                                      <span id="congenital_disease_name"></span>
                                    </div>
                                    <div class="col-sm-12">
                                      <label><b>Precaution:</b></label>
                                      <span id="precaution"></span>
                                    </div>
                                    <div class="col-sm-12">
                                      <label><b>Past history</b></label>
                                      <span id="past_history"></span>
                                    </div>
                                    <div class="col-sm-12">
                                      <br>
                                    </div>
                                    <div class="col-sm-4">
                                      <label><b>HR:</b></label>
                                      <span id="hr"></span> b/m
                                    </div>
                                    <div class="col-sm-4">
                                      <label><b>BP:</b></label>
                                      <span id="bp_mm"></span>/<span id="bp_hg"></span> mm/Hg
                                    </div>
                                    <div class="col-sm-4">
                                      <label><b>RR:</b></label>
                                      <span id="rr"></span> times/min
                                    </div>
                                    <div class="col-sm-12">
                                      <label><b>General observation and Inspection:</b></label>
                                      <div id="observation_inspection"></div>
                                    </div>
                                    <div class="col-sm-12">
                                      <div class="card1">
                                        <div class="card-body1">
                                          <label><b>Aggravating Factor: </b></label>
                                          <span id="aggravating_factor"></span><br>
                                          <label><b>Easing Factor: </b></label>
                                          <span id="easing_factor"></span><br>
                                          <label><b>24 hours pattern </b></label>
                                          <div class="col-sm-12">
                                            <label><b>A.M. : </b></label>
                                            <span id="a_m"></span><br>
                                            <label><b>P.M. : </b></label>
                                            <span id="p_m"></span><br>
                                            <label><b>Night : </b></label>
                                            <span id="night"></span><br><br>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                    <div class="col-sm-12">
                                      <label>แปลผล: </label>
                                      <span id="pt_interpret"></span>
                                    </div>
                                    <div class="col-sm-12">
                                      <label><b>Analyses</b></label>
                                      <div id="analyses"></div>
                                    </div>
                                    <div class="col-sm-12">
                                      <label><b>Treatment</b></label>
                                      <div id="treatment"></div>
                                    </div>
                                    <div class="col-sm-12">
                                      <label><b>Next Appointment : </b></label>
                                      <span id="examination_next"></span>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div id="menu1" class="container tab-pane"><br>
                        <h3 class="text-center">พัฒนาการการรักษา</h3>
                        <select name="pickaction" id="pickaction" onchange="pickactiongg()"></select>
                        <br>
                        <!-- <div id="showchartAll" style="height: 370px; width: 100%;"></div> -->
                        <div id="chartContainer" style="height: 370px; width: 100%;"></div>
                        <br>
                      </div><br>
                      <div class="wizard-footer">
                        <div class="pull-right">
                          <input type='button' class='btn btn-next btn-fill btn-danger btn-wd' name='next'
                            value='ถัดไป' />
                        </div>
                        <div class="pull-left">
                          <input type='button' class='btn btn-previous btn-default btn-wd' name='previous'
                            value='ย้อนกลับ' />
                        </div>
                        <div class="clearfix"></div>
                      </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="fixed-plugin">
        <div class="dropdown open">
          <a href="../index.html">
            <i class="fa fa-arrow-circle-o-left fa-3x"> </i>
          </a>
        </div>
      </div>

    </div>
    </div>
  </section>


  <script>
    function handleFormSubmit(event) {
        event.preventDefault();
        const data = new FormData(event.target);
        const formJSON = Object.fromEntries(data.entries());
        const results = document.querySelector('.results pre');
    }
    const form = document.querySelector('.contact-form');
    form.addEventListener('submit', handleFormSubmit);

    var data_soap;
    var result;
    $(document).ready(function () {
      var upload = document.getElementById('fileInput');

      if (upload) {
        upload.addEventListener('change', function () {
          if (upload.files.length > 0) {
            var reader = new FileReader();
            reader.addEventListener('load', function () {
              result = JSON.parse(reader.result);
              console.log(result)
              data_soap = result[0].data_soap;
              console.log(result[0].patients_info)
              console.log(result[0].data_soap)
              console.log(result[0].charts);
              console.log(result[0].data_soap.length);

              document.getElementById("count").innerHTML = result[0].data_soap.length;
              document.getElementById("physiotherapist_number").innerHTML = result[0].patients_info
                .physiotherapist_number;
              document.getElementById("patient_number").innerHTML = result[0].patients_info
                .patient_number;
              document.getElementById("f_name").innerHTML = result[0].patients_info.f_name;
              document.getElementById("l_name").innerHTML = result[0].patients_info.l_name;
              document.getElementById("gender").innerHTML = result[0].patients_info.gender;
              document.getElementById("birthday").innerHTML = result[0].patients_info.birthday;
              document.getElementById("occupation").innerHTML = result[0].patients_info.occupation;
              document.getElementById("chief_compalaint").innerHTML = result[0].patients_info.chief_compalaint;
              document.getElementById("pt_diagnosis").innerHTML = result[0].patients_info.pt_diagnosis;
              document.getElementById("past_history").innerHTML = result[0].patients_info.past_history;
              document.getElementById("congenital_disease_name").innerHTML = result[0].patients_info
                .congenital_disease_name;

              var htmlhistory_illness = ' <div class="col-sm-12" >';
              var history_illnessid = document.getElementById('history_illnessid');
              result[0].patients_info.history_illness.forEach((x, index) => {
                htmlhistory_illness +=
                  `<span id="history_illness${index+1}">${x.date_present}</span><br><span id="present_history${index+1}">${x.present_history}</span><br>`;
              })
              history_illnessid.innerHTML += htmlhistory_illness;
              history_illnessid.innerHTML += '<div>';

              var newaction = [];
              result[0].charts.forEach(el => {
                newaction.push(el.action);
              })
              var ax = Array.from(new Set(newaction))

              var html1 = '';
              html1 += '<select>';
              html1 += `<option value="">เลือก Action</option>`
              ax.forEach(x => {
                html1 += `<option value="${x}">${x}</option>`

              });
              html1 += '</select>';
              document.getElementById("pickaction").innerHTML = html1;

              var html = '';
              html += '<select>';
              html += `<option value="">เลือกวันที่ผู้ป่วยมารักษา</option>`
              result[0].data_soap.forEach(x => {
                html += `<option value="${x.date_treatment}">${x.date_treatment}</option>`

              });
              html += '</select>';

              document.getElementById("personlist").innerHTML = html;
            });
            reader.readAsText(upload.files[0]);
          }
        });
      }
    });

    function pickactiongg() {
      var getdataaction = document.getElementById("pickaction").value;
      var realaction = [];
      var chartnormal = [];
      var chartarom = [];
      var chartprom = [];

      result[0].charts.forEach((x, index) => {
        if (x.action == getdataaction) {
          chartnormal.push({
            "label": x.date,
            "y": x.normal,
            "action": x.action
          });
          chartarom.push({
            "label": x.date,
            "y": x.arom,
            "action": x.action
          });
          chartprom.push({
            "label": x.date,
            "y": x.prom,
            "action": x.action
          });

        }
      })
      showchart(chartnormal, chartarom, chartprom);
    }

    function showdate() {
      var datedate;
      var x = document.getElementById("personlist").value;
      data_soap.forEach(element => {
        if (x == element.date_treatment) {
          datedate = element;
        }
        console.log(element);
      })
      document.getElementById("pt_interpret").innerHTML = datedate.pt_interpret;
      document.getElementById("precaution").innerHTML = datedate.precaution;
      document.getElementById("hr").innerHTML = datedate.hr;
      document.getElementById("bp_mm").innerHTML = datedate.bp_mm;
      document.getElementById("bp_hg").innerHTML = datedate.bp_hg;
      document.getElementById("rr").innerHTML = datedate.rr;
      document.getElementById("observation_inspection").innerHTML = datedate.observation_inspection;
      document.getElementById("analyses").innerHTML = datedate.analyses;
      document.getElementById("treatment").innerHTML = datedate.treatment;
      document.getElementById("aggravating_factor").innerHTML = datedate.aggravating_factor;
      document.getElementById("easing_factor").innerHTML = datedate.easing_factor;
      document.getElementById("a_m").innerHTML = datedate.a_m;
      document.getElementById("p_m").innerHTML = datedate.p_m;
      document.getElementById("night").innerHTML = datedate.night;
      document.getElementById("date_treatment").innerHTML = datedate.date_treatment;
      document.getElementById("examination_next").innerHTML = datedate.examination_next;
    }

    function showchart(chartnormal, chartarom, chartprom) {
      var chart = new CanvasJS.Chart("chartContainer", {
        animationEnabled: true,
        title: {
          text: chartnormal[0].action
        },
        axisX: {
          valueFormatString: "DD/MM/YYYY",
        },
        axisY: {
          title: "Angle (in °)",
          suffix: " °"
        },
        legend: {
          cursor: "pointer",
          fontSize: 16,
          itemclick: toggleDataSeries
        },
        toolTip: {
          shared: true
        },
        data: [{
            name: "Normal",
            type: "spline",
            showInLegend: true,
            dataPoints: chartnormal
          },
          {
            name: "AROM",
            type: "spline",
            showInLegend: true,
            dataPoints: chartarom
          },
          {
            name: "PROM",
            type: "spline",
            showInLegend: true,
            dataPoints: chartprom
          }
        ]
      });
      chart.render();

      function toggleDataSeries(e) {
        if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
          e.dataSeries.visible = false;
        } else {
          e.dataSeries.visible = true;
        }
        chart.render();
      }
    }
  </script>

</body>

<!--   Core JS Files   -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!-- <script src="../assets/js/jquery-2.2.4.min.js" type="text/javascript"></script> -->
<script src="../assets/js/bootstrap.min.js" type="text/javascript"></script>
<script src="../assets/js/jquery.bootstrap.wizard.js" type="text/javascript"></script>

<!--  Plugin for the Wizard -->
<script src="../assets/js/demo.js" type="text/javascript"></script>
<script src="../assets/js/paper-bootstrap-wizard.js" type="text/javascript"></script>

<!--  More information about jquery.validate here: https://jqueryvalidation.org/	 -->
<script src="../assets/js/jquery.validate.min.js" type="text/javascript"></script>

</html>