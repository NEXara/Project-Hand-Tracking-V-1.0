<!doctype html>
<html lang="th">
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />
	<title>Hand Tracking System 1.0</title>
	<link rel="icon" type="image/png" href="../assets/img/favicon.png" />
	
	<!-- CSS Files -->
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet" />
	<link href="../assets/css/paper-bootstrap-wizard.css" rel="stylesheet" />
	<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script> -->
	<script src="../assets/js/jquery-3.5.1.min.js"></script>
	<script src="../assets/js/js-bootstrap-3.4.1.min.js"></script>

	<!-- Date Picker -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css"/> 
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.th.min.js"></script>
	<!-- <script src="../assets/js/bootstrap-datepicker-1.9.0.min.js"></script>
	<script src="../assets/js/bootstrap-datepicker-1.9.0.th.min.js"></script>
	<link href="../assets/css/bootstrap-datepicker-1.9.0.min.css" rel="stylesheet" />  -->

	<!-- CSS Just for demo purpose, don't include it in your project -->
	<link href="../assets/css/demo.css" rel="stylesheet" />

	<!-- Fonts and Icons -->
    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.css" rel="stylesheet">
	<link href='https://fonts.googleapis.com/css?family=Muli:400,300' rel='stylesheet' type='text/css'>
	<link href="../assets/css/themify-icons.css" rel="stylesheet">

	<!-- LeapMotion LeapJs and Plugin -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r67/three.js"></script> -->
    <!-- <script src="https://js.leapmotion.com/leap-1.1.0.js"></script> -->
    <!-- <script src="http://js.leapmotion.com/leap-plugins-0.1.12.js"></script> -->
    <!-- <script src="http://js.leapmotion.com/leap.rigged-hand-0.1.4.min.js"></script> -->
	<script src="../assets/js/three.r67.js"></script>
	<script src="../assets/js/leap-1.1.0.js"></script>
	<script src="../assets/js/leap-plugins-0.1.12.js"></script>
	<script src="../assets/js/leap.rigged-hand-0.1.4.js"></script>
    <link rel="stylesheet" href="../assets/css/custome_page/index.css">

	 <style>
        canvas {
            z-index: -1;
        }
		input[type='submit'], button, [aria-label]{
      	cursor: pointer;
    	}
		#spoiler{
      		display: none;
    	}
    </style>
</head>

<body>
<section class="contact-form">
				<div class="container-fluid">
					<div class="row">
						<div class="container-fluid">
							<!--      Wizard container        -->
							<br>
							<div class="container-fluid">
								<div class="card wizard-card" data-color="green" id="wizard">
									<form name="tab1" id="tab1">
										<div class="wizard-header">
											<h3 class="wizard-title">เพิ่มข้อมูลผู้ป่วยรายใหม่เเละอาการที่ต้องการรักษา</h3>
										</div>
										<div class="wizard-navigation">
											<div class="progress-with-circle">
												<div class="progress-bar" role="progressbar" aria-valuenow="1" aria-valuemin="1" aria-valuemax="4" style="width: 15%;"></div>
											</div>
											<ul>
												<li aria-disabled="true">
													<a href="#patient_information" data-toggle="tab">
														<div class="icon-circle">
															<i class="fa fa-user-plus"></i>
														</div>
														ข้อมูลผู้ป่วย
													</a>
												</li>
												<li aria-disabled="true">
													<a href="#illness" data-toggle="tab">
														<div class="icon-circle">
															<i class="fa fa-clipboard"></i>
														</div>
														อาการเจ็บป่วย
													</a>
												</li>
												<li>
													<a href="#hi_illness" data-toggle="tab">
														<div class="icon-circle">
															<i class="fa fa-stethoscope"></i>
														</div>
														ประวัติการเจ็บป่วย
													</a>
												</li>
											</ul>
										</div>
										<div class="tab-content">
											<div class="tab-pane" id="patient_information">
												<h5 class="info-text"> ข้อมูลผู้ป่วยเเละประวัติการเจ็บป่วย</h5>
												<div class="row">
													<div class="form-group col-sm-4"> 
														<label for="physiotherapist_number">ชื่อนักกายภาพบำบัด<span class="text_necessary">*</span></label>
														<div class="mb-2 col-sm-12">
															<input type="text" class="form-control" name="physiotherapist_number" id="physiotherapist_number" maxlength="60" placeholder="ชื่อนักกายภาพบำบัด" autocomplete="off" value=""  required title="กรุณากรอกชื่อนักกายภาพบำบัด" >
														</div>
													</div><br><br><br><br><br>
													<hr>
													<div class="form-group col-sm-2"> 
														<label for="patient_number">หมายเลขของผู้ป่วย<span class="text_necessary">*</span></label>
														<div class="mb-2 col-sm-12">
															<input type="text" class="form-control" name="patient_number" id="patient_number" placeholder="หมายเลขของผู้ป่วย" maxlength="8" pattern="[0-9]{8}" autocomplete="off" value=""  required title="กรุณากรอกหมายเลขผู้ป่วย">
														</div>
													</div>
													<div class="form-group col-md-4">
														<label for="f_name">ชื่อ - </label>
														<div class="mb-2 col-sm-12">
															<input type="text" class="form-control" name="f_name" id="f_name" maxlength="30" placeholder="ชื่อ" autocomplete="off" value=""  required title="กรุณากรอกชื่อผู้ป่วย">
														</div>
														<label for="l_name">นามสกุล</label><span class="text_necessary">*</span>
														<div class="mb-2 col-sm-12">
															<input type="text" class="form-control" name="l_name" id="l_name" maxlength="30" placeholder="นามสกุล" autocomplete="off" value=""  required title="กรุณากรอกนามสกุล">
														</div>
													</div>
													<div class="form-group col-md-2">
														<label for="gender">เพศ</label><span class="text_necessary">*</span>
														<div class="mb-2 col-sm-12">
															<select class="form-control"  id="gender" name="gender" required title="กรุณาเลือกเพศผู้ป่วย">
															 <option value="">เลือกเพศ</option>
															 <option value="ชาย">ชาย</option>
															 <option value="หญิง">หญิง</option>
														   </select>              
														 </div>  
													</div>
													<div class="form-group col-md-2">
														<label for="birthday">วันเกิด</label><span class="text_necessary">*</span>
														<div class="mb-2 col-sm-12">
															<input class="form-control" id="birthday" name="birthday" placeholder="วัน/เดื่อน/ปี" type="text"  required title="กรุณาเลือกวันเเกิดของผู้ป่วย">
														</div>
													</div>
													<div class="form-group col-sm-12">
														<div class="mb-2 col-sm-4">
															<label for="occupation">อาชีพของผู้ป่วย</label><span class="text_necessary">*</span>
															<input type="text" class="form-control" name="occupation" id="occupation" maxlength="30" placeholder="อาชีพ" autocomplete="off" value=""  required title="กรุณากรอกอาชืพของผู้ป่วย">
														</div>
													</div>		                                	
												</div>
											</div>
											<div class="tab-pane" id="illness">
												<h5 class="info-text">อาการที่ต้องการรักษา</h5>
												<div class="row ">
													<div class="form-group col-sm-12">
														<div class="col-md-6">
															<label for="p_name">อาการของผู้ป่วย (Chief complaint)</label><span class="text_necessary">*</span>
															<div class="mb-2 col-sm-12">
																<input type="text" class="form-control" name="chief_compalaint" id="chief_compalaint" maxlength="120" placeholder="ผู้ป่วยมาด้วยอาการ......เนื่องจากการ....เป็นเวลา x เดือน" required title="กรุณากรอกอาการของผู้ป่วย">
															</div>
														</div>
													</div>
													<div class="form-group col-sm-12">
														<div class="col-md-4">
															<label	label for="pt_diagnosis">วินิจฉัยโดยนักกายภาพว่าผู้ป่วยเป็น (PT diagnosis)</label><span class="text_necessary">*</span>
															<div class="mb-2 col-sm-12">
																<input type="text" class="form-control" name="pt_diagnosis" id="pt_diagnosis" maxlength="80" placeholder="ผู้ป่วยเป็น....." required title="กรุณากรอกอาการที่ผู้ป่วยเป็น">
															</div>
													</div>
													</div>
													<div class="form-group col-sm-12">
														<div class="col-md-9">
														<label for="url">ประวัติการเจ็บป่วยในอดีต (Past history)</label>
														<div for="url">
															<div class="mb-2 col-sm-12">
																<label class="mb-2 mr-sm-2">
																	<input type="checkbox" name="past_history" id="past_history1" value="ไม่มีประวัติการแพ้ยา"> ไม่มีประวัติการแพ้ยา 
																</label>&emsp;
																<label class="mb-2 mr-sm-2">
																	<input type="checkbox" name="past_history" id="past_history2" value="ผู้ป่วยปฏิเสธการสูบบุหรี่"> ผู้ป่วยปฏิเสธการสูบบุหรี่ 
																</label>&emsp;
																<label class="mb-2 mr-sm-2">
																	<input type="checkbox" name="past_history" id="past_history3" value="ผู้ป่วยปฏิเสธการดื่มแอลกอฮอล์"> ผู้ป่วยปฏิเสธการดื่มแอลกอฮอล์
																</label>&emsp;<br>
																<label class="mb-2 mr-sm-2">
																	<input type="checkbox" name="past_history" id="past_history4" value="ผู้ป่วยไม่เคยได้รับอุบัติเหตุ"> ผู้ป่วยไม่เคยได้รับอุบัติเหตุ
																</label>&emsp;
																<label class="mb-2 mr-sm-2">
																	<input type="checkbox" name="past_history" id="past_history5" value="ผู้ป่วยปฏิเสธการผ่าตัด"> ผู้ป่วยปฏิเสธการผ่าตัด
																</label>&emsp;
																<label class="form-inline mr-sm-2">
																	<input onchange="pastmoreCheck();" type="checkbox" id="v_no" name="past_history"> อื่นๆ
																</label>&emsp;
															</div>
															<label id="pastmore" style="display: none;" class="form-inline col-md-12">
																<input class="form-control" rows="1" cols="90" style="width: 30.5%;" id="past_history6" placeholder="ประวัติการเจ็บป่วย อื่นๆ"></input>
																<br>
															</label>
														</div>
														</div>
													</div>
													<div class="form-group col-sm-12">
														<div class="col-md-9">
														<label for="customFile">โรคประจำตัว (Underlying disease)</label><span class="text_necessary">*</span>
														<div class="mb-2 col-sm-12">
														<div class="custom-file">
															<label><input onclick="udCheck();" type="radio" name="underlying_disease" id="ud_no" checked> ไม่มี</label>&emsp;
															<label><input onclick="udCheck();" type="radio" name="underlying_disease" id="ud_yes"> มี</label>&emsp;
															<br>
															<div id="udCheck" style="display: none;">
																<input  class="form-control" rows="1" cols="90" style="width: 30.5%;" name="congenital_disease_name" id="congenital_disease_name" placeholder="โรคประจำตัวของผู้ป่วย"></input>
																<br>
															</div>
														</div>
														</div>
													</div>
													</div>
												</div>
											</div>
											<div class="tab-pane" id="hi_illness">
												<h5 class="info-text">ประวัติการเจ็บป่วย</h5>
												<div class="row">
													<div class="form-group col-sm-3"> 
														<label for="patient_number">วันที่</label>
														<div class="mb-2 col-sm-12">
															<input class="form-control" id="date_present" name="date_present" placeholder="วัน/เดื่อน/ปี" type="text" required title="กรุณาเลื่อกวันที่"><br>
															<button class='file btn-fill btn-danger btn-wd' onclick="history_illness_add()" id="add">เพิ่มข้อมูล</button>
															<div id="spoiler" role="aria-hidden">
																<form id="saveEdit">
																	<input type="submit"   id="seveEdit" value="บันทึกการเเก้ไข" class='file btn-fill btn-warning btn-wd' /> <a onclick="CloseInput()" aria-label="Close">&#10006;</a>
																</form>
															</div>
														</div>
													</div>
													<div class="form-group col-sm-8"> 
														<label for="patient_number">เหตุการณ์</label>
														<div class="mb-2 col-sm-12">
															<textarea class="form-control" rows="4" cols="90" style="width: 80%;" id="present_history" name="present_history" type="text" required title="กรุณากรอกเหตุการณ์"></textarea>
														</div>
													</div>
													<div class="form-group col-sm-10">
														<p id="counter"></p>
														<table class="table table-striped">
															<tbody id="history_illness1">
															</tbody >
														</table>
														<p id="conD"></p>
													</div>
												</div>
											</div>
										</div>
										<div class="wizard-footer">
											<div class="pull-right">
												<input type='button' class='btn btn-next btn-fill btn-danger btn-wd' name='next' value='ถัดไป' />
												<input type='button' class='btn btn-finish btn-fill btn-danger btn-wd' type="button" id="download-bth" name="download-bth" name='finish' value='Download ไฟล์' />
											</div>
											<div class="pull-left">
												<input type='button' class='btn btn-previous btn-default btn-wd' name='previous' value='ย้อนกลับ' />
											</div>
											<div class="clearfix"></div>
										</div>
									</form>
								</div>
							</div> <!-- wizard container -->
						</div>
					</div> <!-- row -->
				</div> <!--  big container -->
				<div class="fixed-plugin">
					<div class="dropdown open">
						<a href="../index.html" >
							<i class="fa fa-arrow-circle-o-left fa-3x"> </i>
						</a>
					</div>
				</div> 
</section>
<script>
	function handleFormSubmit(event) {
        event.preventDefault();
        const data = new FormData(event.target);
        const formJSON = Object.fromEntries(data.entries());
        const results = document.querySelector('.results pre');
    }
    const form = document.querySelector('.contact-form');
    form.addEventListener('submit', handleFormSubmit);

    function download(physiotherapist_number, patient_number, f_name, l_name, gender, birthday, occupation, chief_compalaint, pt_diagnosis, past_history, underlying_disease, congenital_disease_name, history_illness){
    	var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(
			{
				physiotherapist_number:physiotherapist_number,
				patient_number:patient_number,
				f_name:f_name,
				l_name:l_name,
				gender:gender,
				birthday:birthday,
				occupation:occupation,
				chief_compalaint:chief_compalaint,
				pt_diagnosis:pt_diagnosis,
				past_history:past_history,
				underlying_disease:underlying_disease,
				congenital_disease_name:congenital_disease_name,
				history_illness:history_illness
			}
		));
    	var downloadAnchorNode = document.createElement('a');
    	downloadAnchorNode.setAttribute("href",     dataStr);
    	downloadAnchorNode.setAttribute("download", patient_number + ".json");

    	document.body.appendChild(downloadAnchorNode); 
    	downloadAnchorNode.click();
    	downloadAnchorNode.remove();
		Swal.fire({
            text: 'ดาวน์โหลดข้อมูลผู้ป่วยเรียบร้อย',
            icon: 'success',
            confirmButtonText: 'ตกลง',
        }).then((result) => {
            location.assign('../index.html');
        });
    }
</script>
<script>
		var history_illness =[];
		function Count(data) {
			var el   = document.getElementById('counter');
    		var name = 'ประวัติการรักษา';
    	if (data) {
      		if (data > 1) {
        	name = 'ประวัติการรักษา';
      	}
      		el.innerHTML = data + ' ' + name ;
    	} else {
      		el.innerHTML = 'No ' + name;
    	}
  		};
		  var numC=0;
		function FetchAll() {
			var data = '';
			//console.log(numC);
			if(numC==0){
				if (history_illness.length > 0) {
					
					for (i = 0; i < history_illness.length; i++) {
						data += '<tr>';
						data += '<td>' + history_illness[i].date_present + '</td></tr><tr><td>'+ history_illness[i].present_history +'</td></tr>';
						data += '<tr><td><button onclick="Edit(' + i + ')"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></button><button onclick="Delete(' + i + ')"><i class="fa fa-trash-o" aria-hidden="true"></i></button></td>';
						data += '</tr>';
					}
				}
				//console.log(data)
				Count(history_illness.length);		
			//return el.innerHTML = data;
				$("#history_illness1").append(data);
				numC=numC+1;
			}else{
				$("#history_illness1").remove()
				data=data+'<table class="table table-striped">'
				data=data+'<tbody id= "history_illness1">'
				console.log(data)
				if (history_illness.length > 0) {
					for (i = 0; i < history_illness.length; i++) {
						data += '<tr>';
						data += '<td>' + history_illness[i].date_present + '</td></tr><tr> <td>'+ history_illness[i].present_history +'</td></tr>';
						data += '<tr><td><button onclick="Edit(' + i + ')"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></button><button onclick="Delete(' + i + ')"><i class="fa fa-trash-o" aria-hidden="true"></i></button></td></tr>';
						data += '</tr>';
					}
					data += '</tbody>';
					data += '</table>';
				}
				console.log(data)
				Count(history_illness.length);		
			//return el.innerHTML = data;
				$("#conD").append(data);
			}
		};


		function history_illness_add() {
			el = document.getElementById('date_present');
    		el1 = document.getElementById('present_history');

    		var country = el.value;
    		var country1 = el1.value;
    		var ck = 0;
    		if (history_illness.length > 0) {
      			for (i = 0; i < history_illness.length; i++) {

        		if (el.value == history_illness[i].date_present) {
          		ck = 1;
       			}
      			}
    		}
    	if (ck != 1) {

  
      	if (country) {
        // Add the new value
        history_illness.push({date_present:country.trim(), present_history:country1.trim()});
		Swal.fire({
			position: 'top-end',
			icon: 'success',
			title: 'บันทึกข้อมูลเเรียบร้อย',
			showConfirmButton: false,
			timer: 1000
		})
        // Reset input value
        el.value = '';
        el1.value = '';
        // Dislay the new list
        FetchAll(history_illness);
      	}
  		}else{
			Swal.fire({
  			icon: 'error',
  			title: 'การเพิ่มข้อมูลมีค่าซ้ำ',
  			text: 'มีค่าอยู่เเล้วกรุณา ป้อนค่าใหม่',
			})
  		}
			var x = document.getElementById("past_history6").value;
			document.getElementById('v_no').value = x;
		}
		function Edit(item){
			var el = document.getElementById('date_present');
    		var el1 = document.getElementById('present_history');
    		// Display value in the field
    		el.value = history_illness[item].date_present;
    		el1.value = history_illness[item].present_history;
    		//console.log(el.value)
    		//console.log(el)
    		var cke = 0;
    		//console.log(this.history_illness)
    		console.log("history_illness")
    		console.log(history_illness)
    		var conT = history_illness;
			
    		document.getElementById('spoiler').style.display = 'block';
    		self = this;
			document.getElementById("seveEdit").addEventListener("click", function(){ 
				var country = el.value;
				var newData = el1.value;
				var cke = 0;
				console.log("count")
				console.log(conT)
				if (conT.length > 0) {
					for (j = 0; j < conT.length; j++) {
							if (conT[j].date_present == el.value) {
							cke = 1;
							console.log(cke)                      
							}
					}
				}
				if (cke != 1) {
					if (country) {
						// Edit value
						history_illness.splice(item, 1, {date_present:country.trim(), present_history:newData.trim()});
						Swal.fire({
						position: 'top-end',
						icon: 'success',
						title: 'บันทึกข้อมูลเเก้ไขเรียบร้อย',
						showConfirmButton: false,
						timer: 1000
						})
						// Display the new list
						FetchAll(history_illness);
						// Hide fields
						CloseInput();
						//console.log(self.history_illness)
					}
				}else{
					Swal.fire({
  					icon: 'error',
  					title: 'การเเก้ไขข้อมูลมีค่าซ้ำ',
  					text: 'มีค่าอยู่เเล้วกรุณา ป้อนค่าใหม่',
					})
					cke = 0;
				}
		});
			

  		};
	  
		function Delete(item) {
			Swal.fire({
				title: 'ยืนยันการลบ',
				text: "ยืนยันการลบ ข้อมูล",
				icon: 'warning',
				showCancelButton: true,
				confirmButtonColor: '#3085d6',
				cancelButtonColor: '#d33',
				confirmButtonText: 'Yes, delete it!'
			}).then((result) => {
			if (result.isConfirmed) {
					Swal.fire(
					'ลบ!',
					'ลบข้อมูลเรียบร้อย',
					'success'
					)
					history_illness.splice(item, 1);
					FetchAll(history_illness);
			}
			})
		}
		function CloseInput() {
  			document.getElementById('spoiler').style.display = 'none';
		}
		
		document.getElementById("download-bth").addEventListener("click", function(){
                var physiotherapist_number = document.getElementById("physiotherapist_number").value;
                var patient_number = document.getElementById("patient_number").value;
				var f_name = document.getElementById("f_name").value;
				var l_name = document.getElementById("l_name").value;
				var gender = document.getElementById("gender").value;
				var birthday = document.getElementById("birthday").value;
				var occupation = document.getElementById("occupation").value;
				var chief_compalaint = document.getElementById("chief_compalaint").value;
				var pt_diagnosis = document.getElementById("pt_diagnosis").value;
				var past_history = [];
					$.each($("input[name='past_history']:checked"), function(){
                		past_history.push($(this).val());
            		});
				var underlying_disease = document.getElementById("ud_no").value;
				var congenital_disease_name = document.getElementById("congenital_disease_name").value;
            download(physiotherapist_number, patient_number, f_name, l_name, gender, birthday, occupation, chief_compalaint, pt_diagnosis, past_history, underlying_disease, congenital_disease_name, history_illness);
        }, false);
</script>
<script>
		function pastmoreCheck() {
			if (document.getElementById('v_no').checked) {
				document.getElementById("pastmore").style.display = "block"
			} else {
				document.getElementById("pastmore").style.display = "none";
			}
		}
</script>    
<script>
		function udCheck() {
			if (document.getElementById('ud_yes').checked) {
				document.getElementById('udCheck').style.display = 'block';
			}
			else document.getElementById('udCheck').style.display = 'none';
		}
</script>

<!-- Date Picker -->
<script>
	var date_end = new Date();
	date_end.setDate(date_end.getDate());
	$('#birthday').datepicker({
		format: 'dd-mm-yyyy',
		language: 'th',
		endDate : '-3y'
	});
	$('#date_present').datepicker({
		format: 'dd-mm-yyyy',
		language: 'th',
		endDate : 'date_end',
		todayHighlight: true
	});
</script>



</body>

	<!--   Core JS Files   -->
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<!-- <script src="../assets/js/jquery-2.2.4.min.js" type="text/javascript"></script> -->
	<script src="../assets/js/bootstrap.min.js" type="text/javascript"></script>
	<script src="../assets/js/jquery.bootstrap.wizard.js" type="text/javascript"></script>

	<!--  Plugin for the Wizard -->
	<script src="../assets/js/demo.js" type="text/javascript"></script>
	<script src="../assets/js/paper-bootstrap-wizard.js" type="text/javascript"></script>

	<!--  More information about jquery.validate here: https://jqueryvalidation.org/	 -->
	<script src="../assets/js/jquery.validate.min.js" type="text/javascript"></script>
	<!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css"/>	 -->
</html>
